<!DOCTYPE html>
<html>
<head>

  <title>BYTE WELLNESS PVT</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Montserrat', sans-serif; margin:0; padding:0; background:#f5f7fa; color:#333; }
    header { background:#1C39BB; color:white; text-align:center; padding:30px; font-size:36px; font-weight:800; text-transform:uppercase; }
    .container { max-width:1000px; margin:20px auto; padding:0 20px; }
    .card-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:25px; margin-top:25px; }
    .card { background:white; padding:35px 25px; border-radius:15px; box-shadow:0 6px 20px rgba(0,0,0,0.1); text-align:center; font-weight:600; font-size:22px; cursor:pointer; transition:0.2s; text-transform:uppercase; }
    .card:hover { transform:translateY(-6px); box-shadow:0 10px 25px rgba(0,0,0,0.15); }
    .card.disabled { color:#888; border:2px dashed #ccc; cursor:not-allowed; text-transform:none; }
    .btn-back { display:inline-block; margin-top:30px; padding:14px 28px; background:#1C39BB; color:white; font-size:16px; font-weight:700; border:none; border-radius:10px; cursor:pointer; transition:0.3s; text-transform:uppercase; }
    .btn-back:hover { background:#162f94; }
    #inventory h2, #warehouse h2 { font-weight:700; text-align:center; margin-top:20px; color:#1C39BB; text-transform:uppercase; }
    table { width:100%; border-collapse:collapse; background:white; border-radius:12px; overflow:hidden; box-shadow:0 5px 20px rgba(0,0,0,0.1); text-align:center; font-weight:500; font-size:16px; margin-top:25px; }
    th { background:#1C39BB; color:white; padding:14px; text-transform:uppercase; letter-spacing:1px; }
    td { padding:14px; border-bottom:1px solid #ddd; text-align:center; }
    tr:hover { background:#f1f1f1; }
    .hidden { display:none; }
  </style>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#000000">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
</head>
<body>

<header>BYTE WELLNESS PVT</header>

<!-- HOME -->
<div class="container" id="home">
  <div class="card-grid">
    <div class="card" onclick="showInventory()">Inventory</div>
    <div class="card disabled">Sales</div>
  </div>
</div>

<!-- INVENTORY PAGE -->
<div class="container hidden" id="inventory">
  <h2>Warehouses</h2>
  <div class="card-grid">
    <div class="card" onclick="showWarehouse('Master')">Master Warehouse</div>
    <div class="card" onclick="showWarehouse('Mumbai')">Shiprocket - Mumbai</div>
    <div class="card" onclick="showWarehouse('Bangalore')">Shiprocket - Bangalore</div>
    <div class="card" onclick="showWarehouse('Amazon')">Amazon Warehouse</div>
  </div>
  <button class="btn-back" onclick="goHome()">Back</button>
</div>

<!-- WAREHOUSE DETAIL PAGE -->
<div class="container hidden" id="warehouse">
  <h2 id="warehouseName"></h2>
  <div id="lastSynced" style="text-align:center; font-weight:700; margin-bottom:10px; text-transform:uppercase;"></div>
  <table>
    <thead></thead>
    <tbody></tbody>
  </table>
  <button class="btn-back" onclick="showInventory()">Back to Warehouses</button>
</div>

<script>
const API_KEY = "AIzaSyD6yREIVE1b8hq0kiYqFoJBfsLzPiGGv4k";
const SPREADSHEET_ID = "12Hx1lGMB8dPHND7u3vqbN2itq3QHzBCIiBMkRRWbk6Y";

const warehouseSheets = {
  "Master": "Master",
  "Mumbai": "Mumbai",
  "Bangalore": "Bangalore",
  "Amazon": "Amazon"
};

async function fetchWarehouseData(sheetName) {
  const url = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${sheetName}?key=${API_KEY}`;
  const response = await fetch(url);
  const json = await response.json();
  const values = json.values || [];
  if(values.length === 0) return { headers: [], data: [] };
  const headers = values[0];
  const data = values.slice(1);
  return { headers, data };
}

async function showWarehouse(name) {
  const sheetName = warehouseSheets[name];
  const { headers, data } = await fetchWarehouseData(sheetName);

  // Normalize headers to safely find columns (case + spaces)
  const normHeaders = headers.map(h => h.trim().toLowerCase());

  document.getElementById("warehouseName").innerText = name + " Warehouse";
  const syncedElem = document.getElementById("lastSynced");

  // --- Find "Synced At" index using normalized headers
  const syncedIndex = normHeaders.indexOf("synced at");

  // --- LAST SYNCED under heading (dd-mm-yyyy)
let syncedDate = "";
if (syncedIndex !== -1 && data.length > 0) {
  const firstValue = (data[0][syncedIndex] || "").trim();

  if (firstValue.includes("/")) {
    // Format: dd/mm/yyyy
    const [dd, mm, yyyy] = firstValue.split("/");
    if (dd && mm && yyyy) syncedDate = `${dd}-${mm}-${yyyy}`;
  } else if (firstValue.includes("-")) {
    const parts = firstValue.split("-");
    if (parts[0].length === 4) {
  // Format: yyyy-mm-dd (or yyyy-mm-dd hh:mm:ss)
  const dateOnly = firstValue.substring(0, 10); // take only yyyy-mm-dd
  const [yyyy, mm, dd] = dateOnly.split("-");
  if (yyyy && mm && dd) syncedDate = `${dd}-${mm}-${yyyy}`;
}
    else if (parts[0].length === 2) {
      // Format: dd-mm-yyyy â†’ already fine
      syncedDate = firstValue.substring(0, 10);
    }
  }
}
  syncedElem.innerText = "LAST SYNCED: " + (syncedDate || "N/A");

  const table = document.querySelector("#warehouse table");
  const thead = table.querySelector("thead");
  const tbody = table.querySelector("tbody");

  if (data.length === 0) {
    thead.innerHTML = "";
    tbody.innerHTML = `<tr><td colspan="${headers.length}">No data available</td></tr>`;
    return;
  }

  // --- Build headers: remove "Synced At"; add "Days to Stockout" except for Master
  const displayHeaders = headers.filter((_, i) => i !== syncedIndex);
  if (name !== "Master") {
    displayHeaders.push("Days to Stockout");
  }
  thead.innerHTML = "<tr>" + displayHeaders.map(h => `<th>${h}</th>`).join("") + "</tr>";

  // --- Build rows
  tbody.innerHTML = "";
  data.forEach(row => {
    // Remove "Synced At" cell using the same index
    const displayRow = row.filter((_, i) => i !== syncedIndex);

    let daysStockout = "N/A";
    if (name !== "Master") {
      try {
        const availableIndex = normHeaders.indexOf("available");
        const last30Index = normHeaders.indexOf("last 30 days sale");
        const totalInvIndex = normHeaders.indexOf("total inventory");

        let baseQty = 0;
        if (name === "Amazon" && totalInvIndex !== -1) {
          baseQty = parseFloat(String(row[totalInvIndex] || "0").replace(/,/g, ""));
        } else if (availableIndex !== -1) {
          baseQty = parseFloat(String(row[availableIndex] || "0").replace(/,/g, ""));
        }

        const last30 = (last30Index !== -1) ? parseFloat(String(row[last30Index] || "0").replace(/,/g, "")) : 0;

        if (last30 > 0) {
          daysStockout = Math.round((baseQty * 30) / last30);
        }
      } catch (e) {
        console.error("Stockout calc error", e);
      }

      // Append Days to Stockout cell only for non-Master
      displayRow.push(daysStockout);
    }

    // Render row (apply red color for low days where applicable)
    let rowHTML = "<tr>";
    displayRow.forEach((cell, idx) => {
      if (name !== "Master" && idx === displayRow.length - 1 && daysStockout !== "N/A") {
        const threshold = (name === "Amazon") ? 20 : 10;
        const color = (parseFloat(daysStockout) < threshold) ? "#FF4D4F" : "#333";
        rowHTML += `<td style="color:${color}; font-weight:600;">${cell}</td>`;
      } else {
        rowHTML += `<td>${cell}</td>`;
      }
    });
    rowHTML += "</tr>";
    tbody.innerHTML += rowHTML;
  });

  // Switch to detail page
  document.getElementById("home").classList.add("hidden");
  document.getElementById("inventory").classList.add("hidden");
  document.getElementById("warehouse").classList.remove("hidden");
}

function showInventory(){
  document.getElementById("home").classList.add("hidden");
  document.getElementById("inventory").classList.remove("hidden");
  document.getElementById("warehouse").classList.add("hidden");
}

function goHome(){
  document.getElementById("home").classList.remove("hidden");
  document.getElementById("inventory").classList.add("hidden");
  document.getElementById("warehouse").classList.add("hidden");
}
</script>

<script>
if(window.matchMedia('(display-mode: standalone)').matches){
  document.querySelectorAll("a").forEach(link=>{
    link.addEventListener("click",e=>{
      const url = link.getAttribute("href");
      if(url && !url.startsWith("http")){
        e.preventDefault();
        window.location.href = url;
      }
    });
  });
}
</script>
</body>
</html>


